# 无人设备集群控制平台 · 设备流程控制引擎

## 项目简介
本项目是一个面向“无人设备集群控制平台”的**设备流程控制引擎**，支持通过可视化方式灵活配置设备处置流程。系统采用前后端分离架构，前端基于 Vue3 + @vue-flow/core，后端基于 Spring Boot 3，支持流程的建模、保存、加载、实例化、**可视化执行与回放**，并实现了**数据持久化和自动化测试**。

---

## 主要特性
- **可视化流程设计**：支持拖拽、连线、节点属性弹窗编辑，所见即所得。
- **节点类型丰富**：支持“开始节点”、“结束节点”、“动作节点”、“判断节点”。
- **节点属性自定义与扩展**：支持为节点添加任意自定义属性，如设备类型、设备动作、条件表达式等。
- **流程管理**：支持流程的增删查改、导入导出、版本管理。
- **流程实例化与监控**：支持流程的实例启动、状态跟踪，并提供**可视化回放功能，可单步或自动播放流程执行过程**。
- **数据持久化**：后端数据已集成 **MySQL 数据库**，确保数据不丢失。
- **自动化测试**：前后端均已覆盖单元测试和集成测试，保障代码质量与稳定性。
- **美观易用的 UI**：采用 Chrome 原生风格，交互流畅，界面现代。
- **前后端联调**：所有流程数据实时与后端同步，便于集成与扩展。

---

## 技术栈
- **前端**：Vue3、@vue-flow/core、Axios、Vite、Vitest
- **后端**：Spring Boot 3、JDK 17、Maven、MySQL

---

## 目录结构
```
process-engine-demo/
├── backend/         # Spring Boot 后端
├── frontend/        # Vue3 + vue-flow 前端
├── start.sh         # 一键启动脚本
├── stop.sh          # 一键停止脚本
├── restart.sh       # 一键重启脚本
├── start.bat        # Windows 一键启动脚本
├── stop.bat         # Windows 一键停止脚本
├── restart.bat      # Windows 一键重启脚本
└── README.md        # 项目说明
```

---

## 快速开始
1. **后端数据库配置**
   确保本地或远程有可用的 MySQL 8.0+ 数据库实例，并创建一个名为 `process_engine_db` 的数据库。
   你也可以使用 Docker 快速启动一个 MySQL 实例：
   ```bash
   docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=process_engine_db -p 3306:3306 -d mysql/mysql-server:8.0
   ```
   后端配置文件 `backend/src/main/resources/application.properties` 中的数据库连接信息已默认为：
   ```properties
   spring.datasource.url=jdbc:mysql://localhost:3306/process_engine_db?useSSL=false&serverTimezone=UTC
   spring.datasource.username=root
   spring.datasource.password=root
   ```
   如有需要，请根据你的实际情况修改这些配置。

2. **一键启动**
   在项目根目录执行以下命令（Windows 用户运行 `.bat` 脚本，Linux/macOS 用户运行 `.sh` 脚本）：
   ```bash
   # Linux/macOS
   ./start.sh

   # Windows
   .\start.bat
   ```

3. **访问前端**
   浏览器打开：`http://localhost:5173/`

4. **访问后端 API**
   `http://localhost:8080/api/process-definitions`

---

## 主要功能说明
### 1. 流程建模
- 拖拽添加节点，支持“开始”、“结束”、“动作”、“判断”节点。
- 节点类型可切换，并支持通过弹窗为节点添加任意自定义属性（键值对）。
- 节点间可自由连线，支持分支、条件判断。

### 2. 流程管理
- 流程可保存到后端，支持流程列表管理、删除、导入导出 JSON。

### 3. 流程实例监控与回放
- 支持流程实例的启动，并在“实例监控”Tab中提供可视化回放功能。
- 可查看实例执行历史，并支持“启动回放”、“暂停”、“恢复”、“单步执行”。
- 流程图节点将根据时间轴实时高亮显示当前执行节点和已完成节点。

### 4. 流程执行模拟
- 后端流程引擎能够模拟节点执行，并传递输入/输出。
- 条件节点能根据输入和自定义的条件表达式（如“input === 'success'”）来智能选择下一条出边。
- 动作节点会根据“设备类型”和“设备动作”模拟生成输出信息。

---

## 自动化测试
本项目已集成自动化测试，保障前后端代码质量。

### 后端测试
在 `backend` 目录下执行 Maven 测试命令：
```bash
cd backend
mvn test
```

### 前端测试
在 `frontend` 目录下执行 Vitest 测试命令：
```bash
cd frontend
npm test
```

---

## 节点类型与属性
| 节点类型   | 说明           | 可配置属性（自定义属性存储在 `customProps` 中）         |
|------------|----------------|----------------------------------------------------------|
| 开始节点   | 流程起点       | 无                                                       |
| 结束节点   | 流程终点       | 无                                                       |
| 动作节点   | 设备操作步骤   | `label` (节点名称)、`deviceType` (设备类型)、`deviceAction` (设备动作) |
| 判断节点   | 条件分支判断   | `label` (节点名称)、`condition` (条件表达式，如 `input === 'success'`)      |

---

## 美观易用的 UI
- 采用 Chrome DevTools 风格，现代圆角、阴影、色彩搭配。
- 节点、连线、面板均有细致美化，交互流畅。
- 支持节点属性弹窗，操作直观。

---

## 后续可扩展
- **流程执行引擎的真正集成**：与真实设备或模拟器对接，实现命令下发与状态回调。
- **用户与权限管理**：实现用户认证、角色管理、流程权限控制。
- **流程版本管理**：更完善的版本创建、回滚、比较功能。
- **告警与通知机制**：流程执行异常时的邮件、短信或平台告警。
- **多租户支持**：隔离不同用户或组织的流程数据。
- **更丰富的前端组件**：更多类型的节点、连线样式、图表统计等。

---

## 贡献与反馈
如有建议、需求或 bug，欢迎 issue 或 PR。

---

**本项目致力于打造“无人设备集群控制平台”领域内最易用、最灵活的流程引擎。**
